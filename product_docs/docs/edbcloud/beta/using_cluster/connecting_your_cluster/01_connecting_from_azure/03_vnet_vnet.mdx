---
title: VNet-VNet Example
---

To use this method, you need to create [Azure VPN Gateways](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-about-vpngateways) in each connected virtual network. See [Connect Using Azure VPN Gateway Point to Site](#connect-using-azure-vpn-gateway-point-to-site) for details about creating a virtual network gateway. 

!!! Note
    VPN Gateway creation can take up to 45 minutes. 
    
These are the steps to connect using VNet-VNet connections. 

#### Prerequisites

Assume that your EDB Cloud cluster is on a subscription called `development` and is being accessed from a client VM on another subscription `test`. To walk through an example in your own environment, you need: 
 - Your EDB Cloud cluster URL. You can find the URL in the **Connect** tab of your cluster instance in the EDB Cloud portal.
 -  IP address of your EDB Cloud cluster. For example:
   ```
  $ dig +short p-c4j0jfcmp3af2ieok5eg.brcxzr08qr7rbei1.edbcloud.io 
  10.240.1.218
 ```
 -  A Linux client VM called `vm-client` on subscription `test` with the following properties:
    -   Subscription: `test`
    -   resource group: `rg-client`
    -   virtual network: `vnet-client`
    -   virtual network subnet: `snet-client`
 - [psql Postgresql client](https://www.postgresql.org/download/) installed on your client VM.

#### Step 1: Create a VPN Gateway for the EDB Cloud cluster virtual network

 In the **Virtual network gateway** page, create the first VPN gateway for the EDB Cloud Cluster resource virtual network `vnet-japaneast`. Name the VPN gateway "vpng-edbcloud".

 ![](../images/image8.png)

!!! Note
    The VPN gateway automatically creates a dedicated subnet to accommodate its gateway VMs. Ensure that your EDB Cloud virtual network address space has sufficient IP range for the subnet to prevent errors in the virtual network.

#### Step 2: Create a VPN Gateway for the client VM virtual network

In the same way, create the second gateway for your client VM virtual network `vnet-client`. Name the client VPN gateway "vpng-client".

#### Step 3: Add a gateway connection between the two VPN gateways

Add a VPN gateway connection from `vpng-edbcloud`. Azure portal only supports creating gateway connections in the same subscription. Use Azure CLI (or [PowerShell](https://docs.microsoft.com/en-us/azure/vpn-gateway/vpn-gateway-vnet-vnet-rm-ps)) as follows:

1. Get the VPN gateway ID of `vpng-client`.

 **From the EDB Cloud subscription**:

    ```
   $ az network vnet-gateway show -n vpng-edbcloud -g brCxzr08qr7RBEi1-rg-japaneast-management --query "[id]" -otsv
   subscriptions/.../vpng-edbcloud
   ```

 **From the client VM's subscription**:

   ```
   $ az network vnet-gateway show -n vpng-client -g rg-client --query "[id]" -o tsv
   /subscriptions/.../vpng-client
   ```

2. From the EDB Cloud subscription, create a connection from `vpng-edbcloud` to `vpng-client`.

  ```
  $ az network vpn-connection create -n vpnc-edbcloud-client -g brCxzr08qr7RBEi1-rg-japaneast-management --vnet-gateway1 /subscriptions/.../vpng-edbcloud -l japaneast --shared-key "a_very_long_and_complex_psk" \--vnet-gateway2 /subscriptions/.../vpng-client

  ```

 Note down the value for `--shared-key`. It is a PSK for pairing authentication from both sides needed in the next step.

3. From the client VM's subscription, create another connection from `vpng-client` to `vpng-ebdcloud`.

    ```
    $ az network vpn-connection create -n vpnc-client-edbcloud -g rg-client --vnet-gateway1 /subscriptions/.../vpng-client -l japaneast --shared-key "a_very_long_and_complex_psk!" --vnet-gateway2 /subscriptions/.../vpng-edbcloud
    ```

#### Step 4: Verify the connection

1. After a few minutes, verify the gateway connection status either from either virtual networks with the following command:

 ```
 $ az network vpn-connection show --name vpnc-client-edbcloud -g rg-client --query "[connectionStatus]" -o tsv
Connected
 ```

2. Verify the PG service connectivity:

 ```
 $ dig +short p-c4iabjleig4@jngmac48. bxcxztÃ©sqr7rbeil.enterprisedb.network 
 10.240.1.123 
       
 $ psql -h p-c41a6jleig4@jngmac48.brcxzreaqr7rbeil.enterprisedb.network -u edh_admin      
 Password for user edb_admin: 
 
 psql (13.4 (Ubuntu 13.4-1.pgdg28.84+1), server 13.4.8 (Debian 13.4.8-1+deb10)) 
 WARNING : psql major version 13, server major version 13. Some psql features might not work. 
 SSL connection (protocol : TLSV1.3cipherTLS_AES_256_GCM_SHA384, bits : 256, compression : off) Type "help" for help. 
 
 edb_admins=>
 
 ```

