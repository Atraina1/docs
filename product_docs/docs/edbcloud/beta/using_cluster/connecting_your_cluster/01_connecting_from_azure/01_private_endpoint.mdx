---
title: Private Endpoint Example
---

These are the steps to connect using Azure Private Endpoint. To walk through this example in your own environment, see the prerequisites described in [Connection Walkthrough Examples](../../connecting_your_cluster/#connection-walkthrough-examples).

#### Step 1: Create an Azure Private Link Service tied to your EBD Cloud PG service
 
  In the EDB Cloud cluster's virtual network, 
  create an [Azure Private Link Service](https://docs.microsoft.com/en-us/azure/private-link/private-link-service-overview) in your EDB Cloud cluster resource group. 

  1. Get the resource group details from the Azure CLI or the Azure portal and note down the resource group name. For example, if the EDB Cloud cluster's virtual network is `vnet-japaneast`, use the following command: 
 
     ```
       $ az network vnet list --query
      "[?name==\'vnet-japaneast\'].resourceGroup" -o json

     ```
  
  1. On the upper-left part of the page in the Azure portal, select **Create a resource**.
  
  1. Search for Private Link in the *Search the Marketplace* box.

  1. Click **Create**.

  1. Enter `pg-service-private-link` as the name for the Private Link Service and provide additional details as shown in the following screenshot. 
    
    ![Create private link service](../images/image5.png)

  1. Enter the resource group name obtained in step 1. 

  3. In the **Outbound settings** page, select the `kubernetes-internal` load balancer
    and select the IP address of your cluster in the **Load balancer frontend IP
    address**.

     ![Outbound settings](../images/image1.png)

  4. On the **Access security** page, configure the level of access for the private link service.

     ![](../images/image21.png) 
   
   !!! Note
      Depending on the visibility level you set, the client application might need to request access permission from the EDB Cloud tenant to access this private link
    service. See [control service exposure](https://docs.microsoft.com/en-us/azure/private-link/private-link-service-overview#control-service-exposure)
    for details.
    

  5. After the Private Link Service is created, note down its *alias*. The *alias*
   is the unique ID for your private service, which can be shared with the service consumers. Obtain the alias either from the Azure portal
   or by the using the following CLI command:

     ```
       $ az network private-link-service list --query 
      "[?name=='pg-service-private-link'].alias" -o tsv
      pg-service-private-link.48f26b42-45dc-4e80-8e3d-307d58d7d274.japaneast.azure.privatelinkservice
     
     ```
  6. Select **Review + Create**.

  7. Select **Create**.

#### Step 2: Create an Azure Private Endpoint linking to the Private Link Service

  To connect to the PG service, create an Azure Private Endpoint in your VM's virtual network. After you have created the private endpoint, you can use its private IP address to access the PG service.
  
  1. On the upper-left side of the screen in the portal, select **Create a resource > Networking > Private Link** or in the search box enter Private Link.
  
  1. Select **Create**.

  1. In Private Link Center, select **Private endpoints** in the left-hand menu.

  1. In Private endpoints, click **Create**.

  1. Enter "pg-service-private-link" as the name for the Private Link Service and provide additional details as shown in the following screenshot.

   ![](../images/image12.png)

  1. Connect the private endpoint to the EDB Cloud private link service that we created by entering its *alias*.

   ![](../images/image17.png)

  1. In the **Configuration** page, enter the VM's Virtual Network `vnet-client`.

  1. Select **Review + Create**.

  7. Select **Create**.
   
  8. You might have to approve the connection request from the `pg-service-private-link` owner, if the private endpoint's status appears as **Pending** for a long period. 
   
   Switch to the EDB Cloud subscription and from the **Pending connections** page in **Private Link Center** approve the connection request.

  ![](../images/image3.png)


11. Now that you have successfully built a tunnel between your VM's virtual network and the EDB Cloud cluster network, access the private PG service by using the private endpoint.
   
   Get the private endpoint's private IP address using the following scripts:

 ```
  $ NICID=$(az network private-endpoint show -n pl-private-pg-service
  -g rg-client --query "networkInterfaces[0].id" -o tsv)
  $ az network nic show -n ${NICID##*/} -g rg-client --query
  "ipConfigurations[0].privateIpAddress" -o tsv
  100.64.111.5
 ``` 

12. From the VM `vm-client`, access the PG service by using the private IP address.

 ![](../images/image20.png)

#### Step 3: Create Azure Private DNS Zone for the Private Endpoint

EDB recommends using an [Azure Private DNS Zone](https://docs.microsoft.com/en-us/azure/dns/private-dns-privatednszone) with the Private Endpoint to establish a secure connection with the PG service. Provide a private domain name identical to the EDB Cloud PG service's default domain name, i.e. `p-c4ia6jleig40jngmac40.brcxzr08qr7rbei1.edbcloud.io`. 
     
Azure's DNS resolving mechanism ensures that all requests to the domain name from `vnet-client` are resolved to the private endpoint's private IP address `pl-private-pg-service` instead of the PG service's IP address.

1. In the Azure portal search bar, enter "Private DNS Zones" in the search text box and press Enter.
 
1. Click **Private DNS zone**.

1. Click **Create private DNS zone**.

1. Create a private DNS zone using your organization-level domain
name as an apex domain, `brcxzr08qr7rbei1.edbcloud.io`.

 **//////////DO WE NEED TO CORRECT THE NAME IN THE SCREENSHOT?/////////**

 ![](../images/image6.png)

1. Select the **Virtual network** link on the **Private DNS Zone** page of `brcxzr08qr7rbei1.edbcloud.io` and link the private DNS Zone to the VM's virtual network
`vnet-client`.

 ![](../images/image10.png)

1. Add a new record for the private endpoint. The address is a private IP address.

 ![](../images/image4.png)

1. You can now access your PG service with this private domain name.

 ![](../images/image20.png)

 !!! Tip
    You might need to flush your local DNS cache, to resolve your domain name to the new private IP address after adding the private endpoint. For example, on Ubuntu run the following command:

 ```
  $ sudo systemd-resolve --flush-caches
  ```