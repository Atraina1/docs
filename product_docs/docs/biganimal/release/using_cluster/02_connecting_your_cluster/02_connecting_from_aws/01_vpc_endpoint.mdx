---
title: VPC endpoint example

---

This example shows how to connect your cluster using VPC endpoint.

Assume that your cluster is on a aws account called development and is being accessed from a Linux client VM on another subscription called test with the following properties:

Cluster:
AWS account name: development
Cluster ID: p-c4j0jfcmp3af2ieok5eg
Account ID: brcxzr08qr7rbei1
Organization's domain name: biganimal.io
Linux client VM called vm-client:
Subscription: test
Resource group: rg-client
Virtual network: vnet-client
Virtual network subnet: snet-client

## Prerequisites

To walk through an example in your own environment, you need:

- Your cluster URL. You can find the URL in the Connect tab of your cluster instance in the BigAnimal portal.

- The IP address of your cluster. You can find the IP address of your cluster using the following command:

 ```
 $ dig +short p-c4j0jfcmp3af2ieok5eg.brcxzr08qr7rbei1.biganimal.io 
 10.240.1.218
 A Postgresql client, such as psql, installed on your client VM.
 ```

## Step 1: Create an AWS PrivateLink service for your cluster

In this example, you create an AWS PrivateLink service in your cluster's resource group. You must perform this procedure for every cluster that you want to connect to in Azure.

Get the resource group details from the Azure CLI or the Azure portal and note the resource group. For example, if the cluster's VPC is vnet-japaneast, use the following command:

The first thing is to select the region where your cluster is located on AWS and go into the vpc service page. 

Click on “Endpoint Services” in the left pane



Click “create endpoint service”



Insert a name of your choice and select Network as Load Balancer Type.

Select the load balancer of the cluster you want to reach.


Leave all the other parameters with their default value a click “Create”.

Save the “Service name” from the Details tab because you will need it later.


Add any AWS account you want to use the private link from in the “Allow Principal” list.

The arn should look like this arn:aws:iam::<AWS ACCOUNT ID>:root
. I.E. arn:aws:iam::123456789123:root



 

## Step 2: Create an VPC endpoint in each client VPC

Now that your service endpoint is created you just need to connect it to the VPC of your choosing.

This part is partly based on https://docs.aws.amazon.com/vpc/latest/privatelink/vpce-interface.html#create-interface-endpoint 

Go to the AWS Account you want to create the private endpoint. Select the same region of your pg cluster and open the VPC service in the portal.
Click on “Endpoints” in the left pane and create a new endpoint.

Insert a name of your choice, select “Other endpoint services” and paste the name you saved in the previous step.  You can verify if you copied the correct name and if you successfully allowed this account to access the endpoint by clicking “verify service”

Now select which vpc you want to create the endpoint into and which AZ. We suggest to enable the endpoint in all AZ used by your application. Make sure to also have a security group that allow your application to connect to your pg cluster.

## Step 3: Create an Azure Private DNS Zone for the private endpoint

Once  that is done you need to go back to your BigAnimal AWS Account, onto VPC -> Endpoint services. Select the one you created previously and accept the connection.

After a few minutes everything should be ready to be used.
You can find the private endpoint DNS endpoint in the details section in your application AWS Account under “DNS names”




