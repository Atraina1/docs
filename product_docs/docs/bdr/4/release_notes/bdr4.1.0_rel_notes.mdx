---
title: "BDR 4.1.0"
---

This is a minor release of BDR 4 which includes new features as well
as fixes for issues identified in previous versions.

| Type | Category | Description |
| ---- | -------- | ----------- |
| Feature | Reliability and operability | Support in-place major upgrade of Postgres on a BDR node<p>This BDR release include as new command-line utility `bdr_pg_upgrade` which uses `pg_upgrade` to do a major version upgrade of Postgres on a BDR node.</p><p> This reduces the time and network bandwidth necessary to do major version upgrades of Postgres in a BDR cluster.</p>
| Feature | Performance and scalability | Replication lag control <p> Add configuration for a replication lag threshold after which the transaction commits get throttled. This allows limiting RPO without incurring the latency impact on every transaction that comes with synchronous replication.</p>
| Feature | UX / Initial experience | Distributed sequences by default <p> The default value of `bdr.default_sequence_kind` has been changed to `'distributed'` which is new kind of sequence that uses SnowFlakeId for `bigserial` and Galloc sequences for `serial` column type.</p>
| Feature | UX | Simplified synchronous replication configuration <p> New syntax for specifying the synchronous replication options, with focus on BDR groups and SQL based management (as opposed to config file). </p><p> In future versions this will also replace the current Eager Replication and CAMO configuration options.</p>
| Feature | High availability and disaster recovery | Group Commit <p> The initial kind of synchronous commit that can be configured via the new configuration syntax.</p>
| Feature | High availability and disaster recovery | Allow a Raft request to be required for CAMO switching to Local Mode (RT78928)<p> Add a `require_raft` flag to the CAMO pairing configuration which controls the behavior of switching from CAMO protected to Local Mode, introducing the option to require a majority of nodes to be connected to allow to switch to Local Mode.</p>
| Feature | High availability and disaster recovery | Allow replication to continue on `ALTER TABLE ... DETACH PARTITION CONCURRENTLY` of already detached partition (RT78362)<p> Similarly to how BDR 4 handles `CREATE INDEX CONCURRENTLY` when same index already exists, we now allow replication to continue when `ALTER TABLE ... DETACH PARTITION CONCURRENTLY` is receiver for partition that has been already detached.</p>
| Feature | Performance and scalability | Implement buffered write for LCR segment file <p> This should reduce I/O and improve CPU usage of the Decoding Worker.</p>
| Feature | User Experience | Add `fast` argument to `bdr.alter_subscription_disable()` (RT79798)<p>The argument only influences the behavior of `immediate`. When set to `true` (default) it will stop the workers without letting them finish the current work.</p>
| Feature | User Experience | Simplify `bdr.{add,remove}_camo_pair` functions to return void
| Bug fix | Reliability and operability | Keep the `lock_timeout` as configured on non-CAMO-partner BDR nodes<p> A CAMO partner uses a low `lock_timeout` when applying transactions from its origin node.  This was inadvertently done for all BDR nodes rather than just the CAMO partner, which may have led to spurious `lock_timeout` errors on pglogical writer processes on normal BDR nodes.</p>
| Bug fix | User Experience | Show a proper wait event for CAMO / Eager confirmation waits (RT75900)<p>Show correct "BDR Prepare Phase"/"BDR Commit Phase" in `bdr.stat_activity` instead of the default “unknown wait event”.</p>
| Bug fix | User Experience | Reduce log for bdr.run_on_nodes (RT80973)<p> Don't log when setting `bdr.ddl_replication` to off if it's done with the "run_on_nodes" variants of function. This eliminates the flood of logs for monitoring functions.</p>

### Upgrades

This release supports upgrading from the following versions of BDR:

-   4.0.0 and higher
-   3.7.15
-   3.7.16

Please make sure you read and understand the process and limitations described
in the [Upgrade Guide](upgrades) before upgrading.
